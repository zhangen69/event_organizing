!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=29)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=new(r(n(0)).default.Schema)({audit:{createdBy:{type:String,default:null},createdDate:{type:Date,default:Date.now},updatedBy:{type:String,default:null},updatedDate:{type:Date,default:Date.now}}});t.default=o},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(41)),s=r(n(13)),u=function(){function e(e){var t=this;this.model=null,this.modelName=e,Promise.resolve().then((function(){return o(n(42)("./"+t.modelName+".model"))})).then((function(e){t.model=e.default}))}return e.prototype.create=function(e,t){var n=this;void 0===t&&(t={}),t.isAuth&&(e.audit={updatedBy:t.user.username,createdBy:t.user.username});var r=new this.model(e);return new a.default((function(e,t){r.save().then((function(t){var r={status:201,message:n.modelName+" created successfully!",data:t};e(r)})).catch((function(e){var r={status:500,message:n.modelName+" failed to create!",error:e.toString()};t(r)}))}))},e.prototype.fetch=function(e,t){var n=this;return new a.default((function(r,o){var a=[];t.includes&&(a=t.includes.split(","));var s=n.model.findById(e);a.length>0&&a.forEach((function(e){s=s.populate(e)})),s.then((function(e){if(null==e)throw new Error("Product not found!");var t={status:200,message:n.modelName+" fetched successfully!",data:e};r(t)})).catch((function(e){var t={status:500,message:n.modelName+" not found!",error:e.toString()};o(t)}))}))},e.prototype.fetchAll=function(e){var t=this;return new a.default((function(n,r){var o=new s.default(e).getQuery(),a=o.conditions,u=o.options,i=(0===u.sortDirection?"":"-")+u.sort;t.model.countDocuments(a).then((function(r){var o=t.model.find(a).sort(i).skip(u.skip).limit(u.limit);e.includes&&e.includes.length>0&&e.includes.forEach((function(e){o=o.populate({path:e})})),o.then((function(o){var a={status:200,message:t.modelName+" fetched all successfully!",data:o,totalItems:r,currentPage:e.currentPage,totalPages:Math.ceil(r/e.pageSize)};n(a)}))}))}))},e.prototype.update=function(e,t){var n=this;return new a.default((function(r,o){n.model.findById(e._id).then((function(o){if(null==o)throw new Error(n.modelName+" not found!");o.updateOne(n._getUpdateConditions(e,t)).then((function(){n.model.findById(e._id).then((function(e){var t={status:201,message:n.modelName+" updated successfully!",data:e};r(t)}))}))})).catch((function(e){var t={status:500,message:n.modelName+" failed to update!",error:e.toString()};o(t)}))}))},e.prototype.delete=function(e){var t=this;return new a.default((function(n,r){t.model.findByIdAndDelete(e).then((function(e){if(null==e)throw new Error(t.modelName+" not found!");var r={status:200,message:t.modelName+" deleted successfully!"};n(r)})).catch((function(e){var n={status:500,message:t.modelName+" failed to delete!",error:e.toString()};r(n)}))}))},e.prototype._getUpdateConditions=function(e,t){var n={$set:e};return e.hasOwnProperty("audit")&&(t.isAuth&&(e.audit.updatedBy=t.user.username),Object.keys(e.audit).forEach((function(t){return n.$set["audit."+t]=e.audit[t]})),delete n.$set.audit,delete n.$set["audit.updatedDate"],n.$currentDate={"audit.updatedDate":{$type:"date"}}),n},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=function(){function e(e,t){var n=this;this.bypass={create:!1,update:!1,getItemById:!1,getCollection:!1,delete:!1},this.create=function(e,t){void 0===t&&(t=!1),e.post("/"+n.modelName,r.getMiddleware(t),(function(e,t){var r={};e.hasOwnProperty("auth")&&(r=e.auth),n.resHandling(t,n.modelService.create(e.body,r))}))},this.getItemById=function(e,t){void 0===t&&(t=!1),e.get("/"+n.modelName+"/:id",r.getMiddleware(t),(function(e,t){n.resHandling(t,n.modelService.fetch(e.params.id,e.query))}))},this.getCollection=function(e,t){void 0===t&&(t=!1),e.get("/"+n.modelName,r.getMiddleware(t),(function(e,t){var r=e.query.queryModel||"{}";n.resHandling(t,n.modelService.fetchAll(JSON.parse(r)))}))},this.update=function(e,t){void 0===t&&(t=!1),e.put("/"+n.modelName+"/",r.getMiddleware(t),(function(e,t){n.resHandling(t,n.modelService.update(e.body,e.auth))}))},this.delete=function(e,t){void 0===t&&(t=!1),e.delete("/"+n.modelName+"/:id",r.getMiddleware(t),(function(e,t){n.resHandling(t,n.modelService.delete(e.params.id))}))},this.modelName=e,this.modelService=t}return e.prototype.router=function(e){if(!e)throw new Error('"router" is not defined.');return this.create(e,this.bypass.create),this.getItemById(e,this.bypass.getItemById),this.getCollection(e,this.bypass.getCollection),this.update(e,this.bypass.update),this.delete(e,this.bypass.delete),e},e.prototype.resHandling=function(e,t){try{t.then((function(t){e.status(t.status).json(t)})).catch((function(t){e.status(t.status).json(t)}))}catch(e){throw new Error(e)}},e}();t.default=o,e.exports=o},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(17));t.getMiddleware=function(e){return e?function(e,t,n){return n()}:a};var a=function(e,t,n){try{var r=e.headers.authorization.split(" ")[1],a=o.default.verify(r,"secret this should be longer");e.auth={isAuth:!0,user:a},n()}catch(e){t.status(401).json({message:"Access Denied!"})}};t.checkAuth=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=new o.default.Schema({domain:{type:String,required:!0},serial:{type:Number,default:0}});t.default=o.default.model("SerialCounter",a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={user:"noreply.evtorgms@gmail.com",pass:"evtorgms123"},o={host:"smtp.gmail.com",port:465,secure:!0,auth:r};t.default={cloudinary:{cloud_name:"dfupaaz9h",api_key:"597377239584466",api_secret:"6JeSp8D94uXUfMx9a-vH-KyiQ6I"},mongoose:{connection:"mongodb://localhost:27017/demo_db"},mail:o,mailAuth:r}},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0));t.MongooseHelper={Types:{String:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=null),{type:String,default:t,required:e}},Boolean:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),{type:Boolean,default:t,required:e}},Number:function(e,t){return void 0===e&&(e=0),void 0===t&&(t=!1),{type:Number,default:e,required:t}},Date:function(e,t){return void 0===e&&(e=Date.now),void 0===t&&(t=!1),{type:Date,default:e,required:t}},Object:function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),{type:Object,default:e,required:t}},Enum:function(e,t,n){return void 0===t&&(t=e[0]),void 0===n&&(n=!1),{type:String,enum:e,default:t,required:n}},RefObjectId:function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=!1),{type:o.default.Types.ObjectId,ref:e,default:t,required:n}},RefObjectIds:function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=!1),[{type:o.default.Types.ObjectId,ref:e,default:t,required:n}]},Schema:function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=!1),{type:e,default:t,required:n}},SchemaList:function(e,t,n){return void 0===t&&(t=[]),void 0===n&&(n=!1),{type:[e],default:t,required:n}}}}},function(e,t){e.exports=require("rxjs")},function(e,t){e.exports=require("rxjs/operators")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e={}),this.sort="audit.updatedDate",this.sortDirection="DESC",this.pageSize=0,this.currentPage=0,this.searchText="",this.max=null,this.min=null,this.type=null,this.queryType="string",this.filters=[],this.pageSize=e.pageSize||this.pageSize,this.currentPage=e.currentPage||this.currentPage,this.searchText=e.searchText||this.searchText,this.max=e.max||this.max,this.min=e.min||this.min,this.type=e.type||this.type,this.queryType=e.queryType||this.queryType,this.sort=e.sort||this.sort,this.sortDirection=e.sortDirection||this.sortDirection,this.filters=e.filters||this.filters}return e.prototype.getQuery=function(){var e=this,t={},n={skip:this.currentPage*this.pageSize,limit:this.pageSize,sort:"",sortDirection:0};return this.type&&this.searchText&&this._getCondition(t,this),this.filters.length>0&&this.filters.forEach((function(n){n.queryType||(n.queryType="string"),n.type&&e._getCondition(t,n)})),this.sort&&(n.sort=this.sort,n.sortDirection="ASC"===this.sortDirection?0:-1),{conditions:t,options:n}},e.prototype._isEmpty=function(e){return 0===Object.entries(e).length&&e.constructor===Object},e.prototype._getCondition=function(e,t){switch(t.queryType){case"string":void 0!==e[t.type]?e[t.type].push(new RegExp(""+t.searchText,"gi")):e[t.type]=[new RegExp(""+t.searchText,"gi")];break;case"match":e[t.type]=t.searchText;break;case"number":var n={};if(null!=t.min&&(n.$gte=t.min),null!=t.max&&(n.$lte=t.max),void 0!==e[t.type]){var r=Object.keys(e[t.type]);Object.entries(n).forEach((function(n){var o,a,s=n[0],u=n[1];r.includes(s)?void 0!==e.$and?e.$and.push(((o={})[s]=u,o)):e.$and=[e[t.type],(a={},a[s]=u,a)]:e[t.type][s]=u}))}else this._isEmpty(n)||(e[t.type]=n);break;default:throw new Error("Undefined 'queryType' as "+this.queryType)}return e},e}();t.default=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=r(n(0)),s=new a.default.Schema({to:o.MongooseHelper.Types.String(),from:o.MongooseHelper.Types.String(),subject:o.MongooseHelper.Types.String(),message:o.MongooseHelper.Types.String(),isSent:o.MongooseHelper.Types.Boolean(),sentDate:o.MongooseHelper.Types.Date(null),errorMessage:o.MongooseHelper.Types.String(),lastSendDate:o.MongooseHelper.Types.Date(null)});t.default=a.default.model("EmailQueue",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({quantity:{type:Number,required:!0},stockItem:{type:o.default.Types.ObjectId,ref:"StockItem",required:!0},store:{type:o.default.Types.ObjectId,ref:"Store",required:!0},eventPlan:{type:o.default.Types.ObjectId,ref:"EventPlan",default:null},receipt:{type:o.default.Types.ObjectId,ref:"Receipt",default:null},type:{type:String,enum:["StockIn","StockOut","Adjustment"]},stockItemName:String,stockItemUnit:String,stockItemUnitPrice:Number,stockItemCategory:Object,remarks:String});s.add(a.default),t.default=o.default.model("StockTransaction",s)},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("shortid")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=n(9),u=r(n(6)),i=r(n(19)),l=new o.default.Schema({providerService:s.MongooseHelper.Types.RefObjectId("ProviderService"),name:s.MongooseHelper.Types.String(),quantity:s.MongooseHelper.Types.Number(),unit:s.MongooseHelper.Types.String(),unitPrice:s.MongooseHelper.Types.Number(),remarks:s.MongooseHelper.Types.String()}),d=new o.default.Schema({providerFacility:s.MongooseHelper.Types.RefObjectId("ProviderFacility"),name:s.MongooseHelper.Types.String(),quantity:s.MongooseHelper.Types.Number(),unit:s.MongooseHelper.Types.String(),unitPrice:s.MongooseHelper.Types.Number(),remarks:s.MongooseHelper.Types.String()}),c=new o.default.Schema({stockItem:s.MongooseHelper.Types.RefObjectId("StockItem"),name:s.MongooseHelper.Types.String(),quantity:s.MongooseHelper.Types.Number(),unit:s.MongooseHelper.Types.String(),unitPrice:s.MongooseHelper.Types.Number(),remarks:s.MongooseHelper.Types.String()}),f=new o.default.Schema({code:s.MongooseHelper.Types.String(!0,i.default.generate),name:s.MongooseHelper.Types.String(),identityNumber:s.MongooseHelper.Types.String(),email:s.MongooseHelper.Types.String(),phoneNumber:s.MongooseHelper.Types.String(),address:s.MongooseHelper.Types.String(),organization:s.MongooseHelper.Types.String(),gender:s.MongooseHelper.Types.Enum(["Male","Female"]),status:s.MongooseHelper.Types.Enum(["Open","Paid","Cancelled"],"Open"),group:s.MongooseHelper.Types.String(),remarks:s.MongooseHelper.Types.String(),formData:s.MongooseHelper.Types.Object(new Object)}),p=new o.default.Schema({name:s.MongooseHelper.Types.String(),status:s.MongooseHelper.Types.Enum(["Open","InProgress","Done","Verified","Closed","Cancelled"],"Open"),type:s.MongooseHelper.Types.Enum(["Initial","Preparation","InProgress","Schedule","Closed"],"Initial"),processType:s.MongooseHelper.Types.String(),startFromDate:s.MongooseHelper.Types.Date(null,!0),startFromTime:s.MongooseHelper.Types.Date(null,!0),endToDate:s.MongooseHelper.Types.Date(null,!0),endToTime:s.MongooseHelper.Types.Date(null,!0),provider:s.MongooseHelper.Types.RefObjectId("Provider"),services:s.MongooseHelper.Types.SchemaList(l),facilities:s.MongooseHelper.Types.SchemaList(d),providerService:s.MongooseHelper.Types.RefObjectId("ProviderService"),providerFacility:s.MongooseHelper.Types.RefObjectId("ProviderFacility"),personInCharged:s.MongooseHelper.Types.Object(),budgetAmount:s.MongooseHelper.Types.Number(),remarks:s.MongooseHelper.Types.String(),order:s.MongooseHelper.Types.Number()}),m=new o.default.Schema({title:s.MongooseHelper.Types.String(!0),note:s.MongooseHelper.Types.String(!0),date:s.MongooseHelper.Types.Date()}),g=new o.default.Schema({title:s.MongooseHelper.Types.String(),description:s.MongooseHelper.Types.String(),fields:[Object],settings:Object,status:{type:String,enum:["Open","Confirmed","Published"],default:"Open"},remarks:s.MongooseHelper.Types.String()}),h=new o.default.Schema({code:s.MongooseHelper.Types.String(),name:s.MongooseHelper.Types.String(!0),venue:s.MongooseHelper.Types.String(),dateFrom:s.MongooseHelper.Types.Date(),timeFrom:s.MongooseHelper.Types.Date(),dateTo:s.MongooseHelper.Types.Date(),timeTo:s.MongooseHelper.Types.Date(),customer:s.MongooseHelper.Types.RefObjectId("Customer"),status:s.MongooseHelper.Types.Enum(["Draft","Confirmed","Initial","Preparation","InProgress","Closed","Cancelled"],"Draft"),services:s.MongooseHelper.Types.SchemaList(l),facilities:s.MongooseHelper.Types.SchemaList(d),stockItems:s.MongooseHelper.Types.SchemaList(c),attendees:s.MongooseHelper.Types.SchemaList(f),processes:s.MongooseHelper.Types.SchemaList(p),markupRate:s.MongooseHelper.Types.Number(),markupPrice:s.MongooseHelper.Types.Number(),totalCostPrice:s.MongooseHelper.Types.Number(),totalPrice:s.MongooseHelper.Types.Number(),remarks:s.MongooseHelper.Types.String(),notes:s.MongooseHelper.Types.SchemaList(m),registrationForm:s.MongooseHelper.Types.Schema(g)});h.add(a.default),h.pre("save",(function(e){console.log("pre:save");var t=this;u.default.findOne({domain:"EventPlan"}).then((function(n){n?(console.log("update serial: EventPlan"),n.set("serial",n.get("serial")+1),n.save().then((function(n){var r=n.get("serial");console.log("updatedDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","EP-"+o),e()}))):(console.log("create new counter: EventPlan"),new u.default({domain:"EventPlan",serial:1}).save().then((function(n){var r=n.get("serial");console.log("newDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","EP-"+o),e()})))}))})),t.default=o.default.model("EventPlan",h)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2));t.eventServiceSchema=new o.default.Schema({providerService:{type:o.default.Types.ObjectId,ref:"ProviderService"},name:String,quantity:Number,unit:String,unitPrice:Number,remarks:String}),t.eventFacilitySchema=new o.default.Schema({providerFacility:{type:o.default.Types.ObjectId,ref:"ProviderFacility"},name:String,quantity:Number,unit:String,unitPrice:Number,remarks:String}),t.eventStockItemSchema=new o.default.Schema({stockItem:{type:o.default.Types.ObjectId,ref:"StockItem"},name:String,quantity:Number,unit:String,unitPrice:Number,remarks:String});var s=new o.default.Schema({name:String,status:{type:String,enum:["Open","Paid","Cancelled"],default:"Open"},attendeeGroup:{type:o.default.Types.ObjectId,ref:"AttendeeGroup"},remarks:String}),u=new o.default.Schema({name:String,status:{type:String,enum:["Open","Progress","Done","Paid","Cancelled","Closed"],default:"Open"},processType:{type:String,enum:["Initial","Preparation","Schedule","Closure","Other"],default:"Initial"},type:String,startFromDate:{type:Date,required:!0},startFromTime:{type:Date,required:!0},endToDate:{type:Date,required:!0},endToTime:{type:Date,required:!0},provider:{type:o.default.Types.ObjectId,ref:"Provider"},services:{type:[t.eventServiceSchema],default:[]},facilities:{type:[t.eventFacilitySchema],default:[]},providerService:{type:o.default.Types.ObjectId,ref:"ProviderService"},providerFacility:{type:o.default.Types.ObjectId,ref:"ProviderFacility"},personInCharged:{type:Object,default:null},budgetAmount:Number,remarks:String,order:{type:Number,default:0}}),i=new o.default.Schema({name:{type:String,required:!0},customer:{type:o.default.Types.ObjectId,ref:"Customer"},eventPlan:{type:o.default.Types.ObjectId,ref:"EventPlan",default:null},totalBudgetAmount:{type:Number,default:0},services:{type:[t.eventServiceSchema],default:[]},facilities:{type:[t.eventFacilitySchema],default:[]},stockItems:{type:[t.eventStockItemSchema],default:[]},attendees:{type:[s],default:[]},processes:{type:[u],default:[]},registrationForm:{type:o.default.Types.ObjectId,ref:"RegistrationForm",default:null},status:{type:String,enum:["Open","Cancelled","Preparation","Initial","InProgress","Closed"],defualt:"Open"},dateFrom:{type:Date,required:!0},dateTo:{type:Date,required:!0},timeFrom:{type:Date,required:!0},timeTo:{type:Date,required:!0},venue:{type:String,default:null}});i.add(a.default),t.default=o.default.model("Event",i)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=r(n(6)),u=new o.default.Schema({name:String,quantity:Number,unit:String,unitPrice:Number,subTotal:Number}),i=new o.default.Schema({code:String,totalAmount:Number,customer:{type:o.default.Types.ObjectId,ref:"Customer"},quotation:{type:o.default.Types.ObjectId,ref:"Quotation"},eventPlan:{type:o.default.Types.ObjectId,ref:"EventPlan"},invoice:{type:o.default.Types.ObjectId,ref:"Invoice",default:null},lines:{type:[u],default:[]},status:{type:String,enum:["Open","Issued","Confirmed","Paid","Closed","Cancelled"],default:"Open"},remarks:String});i.add(a.default),i.pre("save",(function(e){console.log("pre:save");var t=this;s.default.findOne({domain:"Invoice"}).then((function(n){n?(console.log("update serial: Invoice"),n.set("serial",n.get("serial")+1),n.save().then((function(n){var r=n.get("serial");console.log("updatedDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","INV-"+o),e()}))):(console.log("create new counter: Invoice"),new s.default({domain:"Invoice",serial:1}).save().then((function(n){var r=n.get("serial");console.log("newDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","INV-"+o),e()})))}))})),t.default=o.default.model("Invoice",i)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=r(n(0)),s=r(n(2)),u=r(n(6)),i=new a.default.Schema({service:{type:a.default.Types.ObjectId,ref:"ProviderService",default:null},name:{type:String,required:!0},quantity:{type:Number,default:0},unit:{type:String,required:!0},unitPrice:{type:Number,default:0},subTotal:{type:Number,default:0}}),l=new a.default.Schema({referenceNumber:o.MongooseHelper.Types.String(),payeeName:o.MongooseHelper.Types.String(),payeeIdentityNumber:o.MongooseHelper.Types.String(),draweeName:o.MongooseHelper.Types.String(),draweeIdentityNumber:o.MongooseHelper.Types.String(),issuedDate:o.MongooseHelper.Types.Date()}),d=new a.default.Schema({referenceNumber:o.MongooseHelper.Types.String(),bank:o.MongooseHelper.Types.String(),accountNumber:o.MongooseHelper.Types.String(),payeeName:o.MongooseHelper.Types.String(),payeeIdentityNumber:o.MongooseHelper.Types.String(),transferedDate:o.MongooseHelper.Types.Date()});t.PaymentVoucherSchema=new a.default.Schema({code:{type:String,default:null},totalAmount:{type:Number,default:0},provider:{type:a.default.Types.ObjectId,ref:"Provider",required:!0},receipt:{type:a.default.Types.ObjectId,ref:"Receipt",default:null},eventPlan:{type:a.default.Types.ObjectId,ref:"EventPlan"},lines:{type:[i],default:[]},status:{type:String,enum:["Open","Issued","Signed","Closed","Cancelled"],default:"Open"},photoUrl:{type:String,default:null},remarks:{type:String,default:null},paymentType:o.MongooseHelper.Types.Enum(["Cash","Cheque","BankTransfer"],"Cash"),chequeInfo:o.MongooseHelper.Types.Schema(l),bankTransferInfo:o.MongooseHelper.Types.Schema(d)}),t.PaymentVoucherSchema.add(s.default),t.PaymentVoucherSchema.pre("save",(function(e){console.log("pre:save");var t=this;u.default.findOne({domain:"PaymentVoucher"}).then((function(n){n?(console.log("update serial: PaymentVoucher"),n.set("serial",n.get("serial")+1),n.save().then((function(n){var r=n.get("serial");console.log("updatedDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","PV-"+o),e()}))):(console.log("create new counter: PaymentVoucher"),new u.default({domain:"PaymentVoucher",serial:1}).save().then((function(n){var r=n.get("serial");console.log("newDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","PV-"+o),e()})))}))})),t.default=a.default.model("PaymentVoucher",t.PaymentVoucherSchema)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=r(n(0)),s=r(n(2)),u=r(n(6)),i=new a.default.Schema({referenceNumber:o.MongooseHelper.Types.String(),payeeName:o.MongooseHelper.Types.String(),payeeIdentityNumber:o.MongooseHelper.Types.String(),draweeName:o.MongooseHelper.Types.String(),draweeIdentityNumber:o.MongooseHelper.Types.String(),issuedDate:o.MongooseHelper.Types.Date()}),l=new a.default.Schema({referenceNumber:o.MongooseHelper.Types.String(),bank:o.MongooseHelper.Types.String(),accountNumber:o.MongooseHelper.Types.String(),payeeName:o.MongooseHelper.Types.String(),payeeIdentityNumber:o.MongooseHelper.Types.String(),transferedDate:o.MongooseHelper.Types.Date()}),d=new a.default.Schema({code:o.MongooseHelper.Types.String(),type:o.MongooseHelper.Types.Enum(["Customer","Provider"]),eventPlan:{type:a.default.Types.ObjectId,ref:"EventPlan"},supplierInvoice:o.MongooseHelper.Types.RefObjectId("SupplierInvoice"),invoice:o.MongooseHelper.Types.RefObjectId("Invoice"),provider:o.MongooseHelper.Types.RefObjectId("Provider"),customer:o.MongooseHelper.Types.RefObjectId("Customer"),amount:o.MongooseHelper.Types.Number(),paymentType:{type:String,enum:["Cash","BankTransfer","Cheque"],default:"Cash"},status:{type:String,enum:["Open","Verified","Cancelled","Failed","Closed"]},remarks:String,chequeInfo:o.MongooseHelper.Types.Schema(i),bankTransferInfo:o.MongooseHelper.Types.Schema(l)});d.add(s.default),d.pre("save",(function(e){console.log("pre:save");var t=this;u.default.findOne({domain:"Payment"}).then((function(n){n?(console.log("update serial: Payment"),n.set("serial",n.get("serial")+1),n.save().then((function(n){var r=n.get("serial");console.log("updatedDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","PAY-"+o),e()}))):(console.log("create new counter: Payment"),new u.default({domain:"Payment",serial:1}).save().then((function(n){var r=n.get("serial");console.log("newDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","PAY-"+o),e()})))}))})),t.default=a.default.model("Payment",d)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=r(n(6)),u=new o.default.Schema({name:String,quantity:Number,unit:String,unitPrice:Number,subTotal:Number}),i=new o.default.Schema({code:String,totalAmount:Number,customer:{type:o.default.Types.ObjectId,ref:"Customer"},eventPlan:{type:o.default.Types.ObjectId,ref:"EventPlan"},lines:{type:[u],default:[]},status:{type:String,enum:["Open","Issued","Confirmed","Closed","Revised","Cancelled"]},remarks:String});i.add(a.default),i.pre("save",(function(e){console.log("pre:save");var t=this;s.default.findOne({domain:"Quotation"}).then((function(n){n?(console.log("update serial: Quotation"),n.set("serial",n.get("serial")+1),n.save().then((function(n){var r=n.get("serial");console.log("updatedDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","QUO-"+o),e()}))):(console.log("create new counter: Quotation"),new s.default({domain:"Quotation",serial:1}).save().then((function(n){var r=n.get("serial");console.log("newDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","QUO-"+o),e()})))}))})),t.default=o.default.model("Quotation",i)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,cost:Number,category:{type:o.default.Types.ObjectId,ref:"Category"},description:String,unit:String,unitPrice:Number});s.add(a.default),t.default=o.default.model("StockItem",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=r(n(6)),u=new o.default.Schema({service:{type:o.default.Types.ObjectId,ref:"ProviderService",default:null},facility:{type:o.default.Types.ObjectId,ref:"ProviderFacility",default:null},name:{type:String,required:!0},quantity:{type:Number,default:0},unit:{type:String,required:!0},unitPrice:{type:Number,default:0},subTotal:{type:Number,default:0}}),i=new o.default.Schema({code:{type:String,default:null},totalAmount:{type:Number,default:0},provider:{type:o.default.Types.ObjectId,ref:"Provider"},store:{type:o.default.Types.ObjectId,ref:"Store"},supplierInvoice:{type:o.default.Types.ObjectId,ref:"SupplierInvoice",default:null},lines:{type:[u],default:[]},status:{type:String,enum:["Open","Confirmed","Paid","Closed","Cancelled"],default:"Open"},period:{type:String,enum:["Immediate","ThirtyDays","SixtyDays","NinetyDays"],default:"ThirtyDays"},remarks:{type:String,default:null},eventPlan:{type:o.default.Types.ObjectId,ref:"EventPlan"},referenceNumber:{type:String,required:!0}});i.add(a.default),i.pre("save",(function(e){console.log("pre:save");var t=this;s.default.findOne({domain:"SupplierInvoice"}).then((function(n){n?(console.log("update serial: SupplierInvoice"),n.set("serial",n.get("serial")+1),n.save().then((function(n){var r=n.get("serial");console.log("updatedDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","SPINV-"+o),e()}))):(console.log("create new counter: SupplierInvoice"),new s.default({domain:"SupplierInvoice",serial:1}).save().then((function(n){var r=n.get("serial");console.log("newDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","SPINV-"+o),e()})))}))})),t.default=o.default.model("SupplierInvoice",i)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({username:{type:String,required:!0},passwordHash:{type:String,required:!0},displayName:{type:String,required:!0},email:{type:String,required:!0},phoneNumber:{type:String,required:!0},avatarImageUrl:{type:String,default:null},signatureImageUrl:{type:String,default:null},isLocked:{type:Boolean,default:!1},isResetPasswordLocked:{type:Boolean,default:!1},resetPasswordToken:{type:String,default:null},lastLoggedIn:{type:Date,default:null},accessFailedCount:{type:Number,default:0},isAccessFailedLocked:{type:Boolean,default:!1}});s.add(a.default),t.default=o.default.model("User",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(30)),s=r(n(8)),u=r(n(12)),i=r(n(31)),l=r(n(32)),d=r(n(33)),c=r(n(34)),f=r(n(39)),p=o.default();t.app=p;var m=process.env.PORT||3e3;p.use(i.default()),p.use(l.default.json()),p.use(l.default.urlencoded({extended:!1})),p.use(d.default()),p.use(a.default("combined",{stream:u.default.createWriteStream(s.default.join(__dirname,"../logs.log"),{flags:"a"})})),p.use(c.default),p.use(f.default),p.get("/test",(function(e,t,n){t.json({message:"test"})})),p.listen(m,(function(){console.log("Server is Started: http://localhost:3000")}))},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cors")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=n(5),s=n(35),u=n(38),i=o.default.Router();i.post("/multer/upload",a.checkAuth,u.multerUploader,(function(e,t){var n=e.protocol+"://"+e.get("host")+"/images/"+e.file.filename;t.status(200).json({message:"upload success",url:n})})),i.post("/cloudinary/upload",a.checkAuth,s.cloudinaryUploader,(function(e,t){})),t.default=i},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(36)),a=r(n(18)),s=r(n(37));o.default.config({cloud_name:"dfupaaz9h",api_key:"597377239584466",api_secret:"6JeSp8D94uXUfMx9a-vH-KyiQ6I"});var u=s.default({cloudinary:o.default,folder:"ts-node-app",allowedFormats:["jpg","jpeg","png"],filename:function(e,t,n){n(void 0,t.url)}}),i=a.default({storage:u}).single("image");t.cloudinaryUploader=i},function(e,t){e.exports=require("cloudinary")},function(e,t){e.exports=require("multer-storage-cloudinary")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(18)),a=r(n(8)),s={"image/png":"png","image/jpeg":"jpg","image/jpg":"jpg"},u=o.default.diskStorage({destination:function(e,t,n){var r=s[t.mimetype],o=new Error("Invalid MIME type");r&&(o=null),n(o,a.default.join(__dirname,"../images"))},filename:function(e,t,n){var r=t.originalname.toLowerCase().split(" ").join("-"),o=s[t.mimetype];n(null,r+"-"+Date.now()+"."+o)}}),i=o.default({storage:u}).single("image");t.multerUploader=i},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(0)),s=r(n(7)),u=r(n(40)),i=r(n(56)),l=r(n(57)),d=r(n(60)),c=r(n(61)),f=r(n(62)),p=r(n(63)),m=r(n(64)),g=r(n(65)),h=r(n(66)),y=r(n(67)),v=r(n(68)),_=r(n(69)),S=r(n(70)),b=r(n(71)),M=r(n(72)),w=r(n(73)),T=r(n(74)),P=r(n(75)),j=r(n(76)),O=r(n(77)),I=r(n(82)),k=n(83),D=o.default.Router();D.use("/service",v.default,f.default,p.default,b.default,T.default,l.default,i.default,u.default,d.default,c.default,m.default,j.default,y.default,h.default,w.default,S.default,_.default,M.default,P.default,I.default),D.use("/service/user",O.default),D.use(g.default),k.emailQueueCheckJob.triggeredJobs(),a.default.connect(s.default.mongoose.connection,{useNewUrlParser:!0,useUnifiedTopology:!0}).then((function(e){console.log("Connected to MongoDB!")})).catch((function(e){console.log("Connection failed!",e)})),t.default=D},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("attendance",new a.default("attendance")).router(o.default.Router());t.default=s},function(e,t){e.exports=require("promise")},function(e,t,n){var r={"./attendance.model":43,"./attendee-group.model":44,"./attendee.model":45,"./auditable.model":2,"./category.model":46,"./counter.model":6,"./customer.model":47,"./email-queue.model":14,"./event-plan.model":20,"./event.model":21,"./invoice.model":22,"./payment-voucher.model":23,"./payment.model":24,"./product.model":48,"./provider-facility.model":49,"./provider-service.model":50,"./provider.model":51,"./query.model":13,"./quotation.model":25,"./receipt.model":52,"./registration-form.model":53,"./role.model":54,"./stock-item.model":26,"./stock-transaction.model":15,"./store.model":55,"./supplier-invoice.model":27,"./user.model":28};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id=42},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,description:String,at:[String],event:{type:o.default.Types.ObjectId,ref:"Event"},attendee:{type:o.default.Types.ObjectId,ref:"Attendee"},attendedDate:{type:Date,default:null},remarks:String});s.add(a.default),t.default=o.default.model("Attendance",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,description:String,attachments:[String],event:{type:o.default.Types.ObjectId,ref:"Event"},remarks:String});s.add(a.default),t.default=o.default.model("AttendeeGroup",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(19)),s=r(n(2)),u=new o.default.Schema({code:{type:String,default:a.default.generate},name:String,identityNumber:String,email:String,phoneNumber:String,address:String,organization:String,gender:{type:String,enum:["Male","Female"]},event:{type:o.default.Types.ObjectId,ref:"Event"},registrationForm:{type:o.default.Types.ObjectId,ref:"RegistrationForm"},attendeeGroup:{type:o.default.Types.ObjectId,ref:"AttendeeGroup",default:null},groupName:{type:String},formData:Object,remarks:String});u.add(s.default),u.post("updateOne",(function(e){e.code||(e.code=a.default.generate())})),t.default=o.default.model("Attendee",u)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,type:{type:String,enum:["Facility","Service"]},category:{type:o.default.Types.ObjectId,ref:"Category",default:null},categories:[Object],remarks:String});s.add(a.default),t.default=o.default.model("Category",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,email:String,address:String,registrationNumber:String,personInCharged:{type:[Object],default:[]}});s.add(a.default),t.default=o.default.model("Customer",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:{type:String,required:!0},price:{type:Number,required:!0,default:0},photoUrl:{type:String,default:null}});s.add(a.default),t.default=o.default.model("Product",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,unit:String,unitPrice:Number,photoUrl:String,attachments:[String],provider:{type:o.default.Types.ObjectId,ref:"Provider"},category:{type:o.default.Types.ObjectId,ref:"Category"},description:String});s.add(a.default),t.default=o.default.model("ProviderFacility",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,unit:String,unitPrice:Number,photoUrl:String,attachments:[String],provider:{type:o.default.Types.ObjectId,ref:"Provider"},category:{type:o.default.Types.ObjectId,ref:"Category"},description:String});s.add(a.default),t.default=o.default.model("ProviderService",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,email:String,address:String,registrationNumber:String,personInCharged:{type:[Object],default:[]},remarks:String});s.add(a.default),t.default=o.default.model("Provider",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=r(n(6)),u=new o.default.Schema({stockItem:{type:o.default.Types.ObjectId,ref:"StockItem"},name:String,quantity:Number,unit:String,unitPrice:Number,subTotal:Number}),i=new o.default.Schema({code:{type:String},provider:{type:o.default.Types.ObjectId,ref:"Provider"},store:{type:o.default.Types.ObjectId,ref:"Store"},supplierInvoice:{type:o.default.Types.ObjectId,ref:"SupplierInvoice"},lines:{type:[u],default:[]},remarks:String});i.add(a.default),i.pre("save",(function(e){console.log("pre:save");var t=this;s.default.findOne({domain:"Receipt"}).then((function(n){n?(console.log("update serial: Receipt"),n.set("serial",n.get("serial")+1),n.save().then((function(n){var r=n.get("serial");console.log("updatedDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","RECEIPT-"+o),e()}))):(console.log("create new counter: Receipt"),new s.default({domain:"Receipt",serial:1}).save().then((function(n){var r=n.get("serial");console.log("newDoc.serial.length",r.toString().length);var o="000".substr(0,"000".length-r.toString().length)+r;t.set("code","RECEIPT-"+o),e()})))}))})),t.default=o.default.model("Receipt",i)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2));t.RegistrationFormSchema=new o.default.Schema({name:String,fields:[Object],settings:Object,eventPlan:{type:o.default.Types.ObjectId,ref:"EventPlan"},status:{type:String,enum:["Open","Confirmed","Published"]},remarks:String}),t.RegistrationFormSchema.add(a.default),t.default=o.default.model("RegistrationForm",t.RegistrationFormSchema)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:{type:String,required:!0},rules:{type:String,required:!0}});s.add(a.default),t.default=o.default.model("User",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),a=r(n(2)),s=new o.default.Schema({name:String,description:String,status:{type:String,enum:["Available","Unavailable"],default:"Available"},isDefault:Boolean});s.add(a.default),t.default=o.default.model("Store",s)},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("attendee-group",new a.default("attendee-group")).router(o.default.Router());t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(58)),a=r(n(1)),s=r(n(12)),u=r(n(16)),i=r(n(59)),l=n(10),d=n(11),c=r(n(7)),f=r(n(3)),p=r(n(4)),m=new f.default("attendee"),g=new p.default("attendee",m);g.bypass.create=!0;var h=g.router(a.default.Router());h.post("/attendee/register",(function(e,t,n){var r;l.from(o.default.post("http://localhost:3000/service/attendee",e.body)).pipe(d.map((function(e){return r=e.data.data})),d.mergeMap((function(){var e=l.from(o.default.get("http://localhost:3000/service/event/"+r.event)).pipe(d.map((function(e){return e.data.data}))),t=l.from(i.default.toDataURL(r.code,{errorCorrectionLevel:"H",type:"image/png"}));return l.forkJoin([e,t])}))).subscribe((function(e){console.log("qrcode and event is gotcha!"),r.email&&function(e){var n=e[0],o=e[1];console.log("sending email...");var a=u.default.createTransport(c.default.mail),i="\n            <h1>Congradulations!</h1>\n            <p>Dear "+r.name+",</p>\n            <p>We're appriaciate you registered the event, here are your pass code</p>\n            <h3>"+r.code+"</h3>\n            <p>We are looking foward your attend, thank you.</p>\n        ",l=o.replace(/^data:image\/png;base64,/,"");s.default.writeFileSync("out.png",l,"base64");var d={from:"EvtOrgMs <"+c.default.mailAuth.user+">",to:r.email,subject:"Event Register Confirmation: "+n.name,html:i,attachments:[{filename:n.name+"-qrcode.png",content:s.default.createReadStream("out.png")}]};a.sendMail(d,(function(e,n){if(e)return console.log(e);s.default.unlinkSync("out.png"),console.log("Message %s sent: %s",n.messageId,n.response),t.status(200).json({succeeded:!0,message:"Email sent.",data:r})}))}(e)}),(function(e){console.log("error"),console.log(e)}))})),t.default=h},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("qrcode")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("category",new a.default("category")).router(o.default.Router());t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("customer",new a.default("customer")).router(o.default.Router());t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=r(n(4)),u=r(n(20)),i=n(5),l=n(10),d=n(11),c=r(n(7)),f=r(n(14)),p="event-plan",m=new s.default(p,new a.default(p)).router(o.default.Router());m.get("/event-plan/venue/list",i.checkAuth,(function(e,t,n){u.default.find({venue:{$exists:!0,$ne:null}}).then((function(e){var n=[];l.from(e).pipe(d.map((function(e){return e.venue})),d.distinct()).subscribe({next:function(e){return n.push(e)},complete:function(){return t.status(200).json({data:n})}})}))})),m.post("/event-plan/sendRegistrationFormLink",i.checkAuth,(function(e,t,n){var r='\n            <h1>Registration Form</h1>\n            <p>Please click <a href="http://localhost:4200/register/'+e.body.formId+'">Here</a> to register your seat.</p>\n            <p>Check it out.</p>\n        ';new f.default({to:e.body.email,from:"EvtOrgMs <"+c.default.mailAuth.user+">",subject:"Event Registration Form",message:r}).save().then((function(){t.status(200).json({succeeded:!0,message:"Email sent."})}))})),m.get("/event-plan/getRegistrationForm/:id",(function(e,t,n){u.default.findById(e.params.id).then((function(e){var n={_id:e._id,name:e.name,venue:e.venue,dateFrom:e.dateFrom,timeFrom:e.timeFrom,dateTo:e.dateTo,timeTo:e.timeTo},r=e.registrationForm;r?t.status(200).json({form:r,event:n}):t.status(500).json({message:"form not found"})}))})),m.get("/event-plan/get-attendee-list/:id",i.checkAuth,(function(e,t,n){u.default.findById(e.params.id).then((function(e){var n=e.attendees;t.status(200).json({attendees:n})}))})),m.post("/event-plan/attendee-register",(function(e,t,n){u.default.findById(e.body.event).then((function(n){var r=n.attendees,o={formData:e.body.formData||{}};e.body.name&&(o.name=e.body.name),e.body.identityNumber&&(o.identityNumber=e.body.identityNumber),e.body.email&&(o.email=e.body.email),e.body.address&&(o.address=e.body.address),e.body.phoneNumber&&(o.phoneNumber=e.body.phoneNumber),e.body.organization&&(o.organization=e.body.organization),e.body.gender&&(o.gender=e.body.gender),r.push(o),n.save().then((function(){t.status(200).json({message:"ok"})}))}))})),t.default=m},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),a=n(11),s=r(n(3)),u=r(n(21)),i=r(n(1)),l=r(n(4)),d=n(5),c=new l.default("event",new s.default("event"));c.bypass.getItemById=!0;var f=c.router(i.default.Router());f.get("/event/venue/list",d.checkAuth,(function(e,t,n){u.default.find({venue:{$exists:!0,$ne:null}}).then((function(e){var n=[];o.from(e).pipe(a.map((function(e){return e.venue})),a.distinct()).subscribe({next:function(e){return n.push(e)},complete:function(){return t.status(200).json({data:n})}})}))})),t.default=f},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=r(n(4)),u=n(5),i=r(n(22)),l=new s.default("invoice",new a.default("invoice")).router(o.default.Router());l.get("/invoice/getByEventPlanId/:id",u.checkAuth,(function(e,t,n){e.params.id&&i.default.findOne({eventPlan:e.params.id}).populate("customer").then((function(e){t.status(200).json({data:e})}))})),t.default=l},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(8)),s=o.default.Router();s.use("/images",o.default.static(a.default.join(__dirname,"../images"))),s.use("/assets",o.default.static(a.default.join(__dirname,"../assets"))),s.use("/",o.default.static(a.default.join(__dirname,"./ng-app"))),s.use((function(e,t,n){t.sendFile(a.default.join(__dirname,"./ng-app","index.html"))})),t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=r(n(4)),u=n(5),i=r(n(23)),l="payment-voucher",d=new s.default(l,new a.default(l)).router(o.default.Router());d.get("/"+l+"/getByEventPlanId/:id",u.checkAuth,(function(e,t,n){i.default.find({eventPlan:e.params.id}).populate("provider").then((function(e){t.status(200).json({data:e})}))})),t.default=d},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=r(n(4)),u=n(5),i=r(n(24)),l=new s.default("payment",new a.default("payment")).router(o.default.Router());l.get("/payment/getByEventPlanId/:id",u.checkAuth,(function(e,t,n){i.default.find({eventPlan:e.params.id}).populate("provider").populate("customer").populate("supplierInvoice").populate("invoice").then((function(e){t.status(200).json({data:e})}))})),t.default=l},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("product",new a.default("product"));t.default=s.router(o.default.Router())},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("provider-facility",new a.default("provider-facility")).router(o.default.Router());t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("provider-service",new a.default("provider-service")).router(o.default.Router());t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("provider",new a.default("provider")).router(o.default.Router());t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("receipt",new a.default("receipt")).router(o.default.Router());t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=r(n(4)),u=n(5),i=r(n(15)),l=new a.default("stock-item"),d=new s.default("stock-item",l).router(o.default.Router());d.get("/stock-item-with-qty",u.checkAuth,(function(e,t,n){var r=e.query.queryModel||"{}";l.fetchAll(JSON.parse(r)).then((function(e){var n=e.data.map((function(e){return e._id}));i.default.find({stockItem:{$in:n}}).then((function(n){e.data=e.data.map((function(e){return e.toObject()})).map((function(e){var t=n.filter((function(t){return"StockOut"===t.type&&e._id.toString()===t.stockItem.toString()})).reduce((function(e,t){return e+t.quantity}),0),r=n.filter((function(t){return"StockIn"===t.type&&e._id.toString()===t.stockItem.toString()})).reduce((function(e,t){return e+t.quantity}),0);return e.quantity=r-t||0,e})),t.status(200).json(e)}))}))})),d.get("/stock-item-with-qty/:id",u.checkAuth,(function(e,t,n){l.fetch(e.params.id,e.query).then((function(e){e.data=e.data.toObject(),i.default.find({stockItem:e.data._id}).then((function(n){var r=n.filter((function(e){return"StockOut"===e.type})).reduce((function(e,t){return e+t.quantity}),0),o=n.filter((function(e){return"StockIn"===e.type})).reduce((function(e,t){return e+t.quantity}),0);e.data.quantity=o-r||0,t.status(200).json(e)}))}))})),t.default=d},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=r(n(4)),u=n(5),i=r(n(26)),l=r(n(15)),d=new s.default("stock-transaction",new a.default("stock-transaction")).router(o.default.Router());d.get("/stock-transaction/getQuantityInStock/:stockItemId",u.checkAuth,(function(e,t,n){i.default.findById(e.params.stockItemId).then((function(e){l.default.find({stockItem:e._id}).then((function(n){var r;r=n.filter((function(e){return"StockIn"===e.type})).reduce((function(e,t){return e+t.quantity}),0)-n.filter((function(e){return"StockOut"===e.type})).reduce((function(e,t){return e+t.quantity}),0),t.json({stockItem:e,quantity:r})}))}))})),t.default=d},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=new(r(n(4)).default)("store",new a.default("store")).router(o.default.Router());t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=r(n(4)),u=n(5),i=r(n(27)),l=new s.default("supplier-invoice",new a.default("supplier-invoice")).router(o.default.Router());l.get("/supplier-invoice/getByEventPlanId/:id",u.checkAuth,(function(e,t,n){i.default.find({eventPlan:e.params.id}).populate("provider").then((function(e){t.status(200).json({data:e})}))})),t.default=l},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=n(78),s=n(5),u=o.default.Router();u.post("/register",(function(e,t){a.UserController.register(e.body).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.post("/login",(function(e,t){a.UserController.login(e.body).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.post("/logout",(function(e,t){})),u.post("/changePassword",s.checkAuth,(function(e,t){e.auth.isAuth&&(e.body.username=e.auth.user.username),a.UserController.changePassword(e.body,e.auth).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.get("/fetchProfile",s.checkAuth,(function(e,t){e.auth.isAuth||t.status(401).json({message:"Access Denied"}),a.UserController.fetchProfile(e.auth.user._id).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.put("/updateProfile",s.checkAuth,(function(e,t){a.UserController.updateProfile(e.body).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.post("/emailConfirmed",(function(e,t){})),u.post("/forgotPassword",(function(e,t){a.UserController.forgotPassword(e.body).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.post("/verifyResetPasswordToken",(function(e,t){a.UserController.verifyResetPasswordToken(e.body).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.get("/",s.checkAuth,(function(e,t){var n=e.query.queryModel?JSON.parse(e.query.queryModel):{};a.UserController.fetchAll(n,e.auth).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.get("/:id",s.checkAuth,(function(e,t){a.UserController.fetch(e.params.id).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.post("/",s.checkAuth,(function(e,t){a.UserController.register(e.body).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.put("/",s.checkAuth,(function(e,t){a.UserController.update(e.body,e.auth).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.post("/lock",s.checkAuth,(function(e,t){a.UserController.lock(e.body,e.auth).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.post("/unlock",s.checkAuth,(function(e,t){a.UserController.unlock(e.body,e.auth).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),u.post("/resetPassword",(function(e,t){a.UserController.resetPassword(e.body).then((function(e){t.status(e.status).json(e)})).catch((function(e){t.status(e.status).json(e)}))})),t.default=u},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{i(r.next(e))}catch(e){a(e)}}function u(e){try{i(r.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}i((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=a(n(79)),u=a(n(17)),i=a(n(16)),l=n(80),d=a(n(7)),c=n(81),f=a(n(13)),p=a(n(28)),m=new(function(){function e(){}return e.prototype.register=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.findUsers({$or:[{username:e.username},{email:e.email}]})];case 1:return t.sent().length>0?[2,{status:400,message:"Username or Email already existed. Please try again"}]:[4,this.createUser(e,"user created successfully!")];case 2:return[2,t.sent()]}}))}))},e.prototype.login=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,i,l,d,c,f;return o(this,(function(o){switch(o.label){case 0:return[4,this.findUser({username:e.username})];case 1:return null==(t=o.sent())?[2,{status:500,message:"User not found."}]:(n={status:401,message:"Username or Password are incorrect. Please try again"},t?s.default.compareSync(e.password,t.passwordHash)?[3,4]:t.isAccessFailedLocked?[2,{status:423,message:"Your account access failed 3 times, please contact admin to unlock the account"}]:t.accessFailedCount<3?(r=t.accessFailedCount+1,a=t.accessFailedCount+1===3,[4,this.updateUser(t,{accessFailedCount:r,isAccessFailedLocked:a})]):[3,3]:[2,n]);case 2:o.sent(),o.label=3;case 3:return[2,n];case 4:return i=this.userLockHandler(t),l=i.succeeded,d=i.status,c=i.message,l?(f={status:200,message:"logged in!",token:u.default.sign({username:t.username,_id:t._id},"secret this should be longer",{expiresIn:"1d"}),expiresIn:864e5},t.accessFailedCount>0?[4,this.updateUser(t,{accessFailedCount:0})]:[3,6]):[2,{status:d,message:c}];case 5:o.sent(),o.label=6;case 6:return[2,f]}}))}))},e.prototype.changePassword=function(e,t){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.findUser({username:e.username})];case 1:return null==(t=n.sent())?[2,{status:500,message:"User not found."}]:s.default.compareSync(e.password,t.passwordHash)?(t.passwordHash=s.default.hashSync(e.newPassword,10),[4,this.saveUser(t,"user password changed successfully!")]):[2,{status:403,message:"Password are invalid! Please try again."}];case 2:return[2,n.sent()]}}))}))},e.prototype.fetchProfile=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.findUserById(e)];case 1:return t=n.sent(),[2,{status:200,data:c.mapDocToUserDTO(t)}]}}))}))},e.prototype.updateProfile=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.findUserByIdAndUpdate(e._id,e,"update profile successfully!")];case 1:return[2,t.sent()]}}))}))},e.prototype.forgotPassword=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a;return o(this,(function(o){switch(o.label){case 0:return[4,this.findUser({username:e.username,email:e.email})];case 1:return null==(t=o.sent())?[2,{status:500,message:"User not found."}]:(n={isResetPasswordLocked:!0,resetPasswordToken:l.v4()},r="http://localhost:4200/auth/resetPassword/"+n.resetPasswordToken,[4,this.sendEmail(t,r)]);case 2:return a=o.sent(),console.log("result",a),[4,this.updateUser(t,n,"sent reset password email to "+e.email+", account will temperarily locked until user changed password.")];case 3:return[2,o.sent()]}}))}))},e.prototype.sendEmail=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a;return o(this,(function(o){switch(o.label){case 0:return n=i.default.createTransport(d.default.mail),r="\n            <h1>Reset Password</h1>\n            <p>Dear "+e.displayName+',</p>\n            <h3><a href="'+t+'">Click here</a> to reset your password</h3>\n        ',a={from:"EvtOrgMs <"+d.default.mailAuth.user+">",to:e.email,subject:"Reset Password",html:r},[4,n.sendMail(a,(function(e,t){if(e)return console.log(e);console.log("Message %s sent: %s",t.messageId,t.response)}))];case 1:return o.sent(),[2,{message:"successfully sent",suceeded:!0}]}}))}))},e.prototype.verifyResetPasswordToken=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.findUser({resetPasswordToken:e.token})];case 1:return null==t.sent()?[2,{status:500,message:"Token is invalid."}]:[2,{status:200,verified:!0}]}}))}))},e.prototype.fetch=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.findUserById(e)];case 1:return t=n.sent(),[2,{status:200,data:c.mapDocToUserDTO(t)}]}}))}))},e.prototype.fetchAll=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s,u;return o(this,(function(o){switch(o.label){case 0:return n=new f.default(e).getQuery(),r=n.conditions,a=n.options,t.isAuth&&(r.username={$ne:t.user.username}),[4,this.estimatedDocumentCount(r)];case 1:return s=o.sent(),[4,this.findUsers(r,a)];case 2:return u=o.sent(),[2,{status:200,data:c.mapColletionToUserDTO(u),totalItems:s,currentPage:e.currentPage,totalPages:Math.ceil(s/e.pageSize)}]}}))}))},e.prototype.update=function(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,this.findUserByIdAndUpdate(e._id,this._getUpdateConditions(e,t),"user updated successfully!")];case 1:return[2,n.sent()]}}))}))},e.prototype.lock=function(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.findUserByIdAndUpdate(e._id,{isLocked:!0},"user locked successfully!")];case 1:return[2,t.sent()]}}))}))},e.prototype.unlock=function(e,t){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return[4,this.findUserById(e._id)];case 1:return null==(t=r.sent())?[2,{status:500,message:"User not found."}]:(n={isLocked:!1},t.isAccessFailedLocked&&(n.isAccessFailedLocked=!1,n.accessFailedCount=0),t.isResetPasswordLocked?[2,{status:500,message:"failed to unlock account, because it is locked by reset password. either user changed password or retry send a new reset password email to unlock the account."}]:[4,this.updateUser(t,n,"user locked successfully!")]);case 2:return[2,r.sent()]}}))}))},e.prototype.resetPassword=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return[4,this.findUser({username:e.username,resetPasswordToken:e.token})];case 1:return null==(t=o.sent())?[2,{status:500,message:"Failed to reset password. Username or Token is invalid."}]:(n=s.default.hashSync(e.newPassword,10),r={passwordHash:n,resetPasswordToken:null,isResetPasswordLocked:!1},[4,this.updateUser(t,r,"your password was changed successfully!")]);case 2:return[2,o.sent()]}}))}))},e.prototype.findUsers=function(e,t){var n=this;return new Promise((function(r,o){var a=("ASC"===t.sortDirection?"":"-")+t.sort;p.default.find(e).sort(a).skip(t.skip).limit(t.limit).exec((function(e,t){return n.resHandler({resolve:r,reject:o},{err:e,res:t})}))}))},e.prototype.findUser=function(e){var t=this;return new Promise((function(n,r){p.default.findOne(e,(function(e,o){return t.resHandler({resolve:n,reject:r},{err:e,res:o})}))}))},e.prototype.findUserById=function(e){return this.findUser({_id:e})},e.prototype.findUserByIdAndUpdate=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return[4,this.findUserById(e)];case 1:return r=o.sent(),[4,this.updateUser(r,t,n)];case 2:return[2,o.sent()]}}))}))},e.prototype.createUser=function(e,t){var n=this;return new Promise((function(r,o){e.passwordHash=s.default.hashSync(e.password,10),new p.default(e).save((function(e,a){return n.resHandler({resolve:r,reject:o},{err:e,res:a},{status:201,message:t})}))}))},e.prototype.updateUser=function(e,t,n){var r=this;return new Promise((function(o,a){e.updateOne(t,(function(e,t){return r.resHandler({resolve:o,reject:a},{err:e,res:t},{status:200,message:n})}))}))},e.prototype.saveUser=function(e,t){var n=this;return new Promise((function(r,o){e.save((function(e,a){return n.resHandler({resolve:r,reject:o},{err:e,res:a},{status:200,message:t})}))}))},e.prototype.estimatedDocumentCount=function(e){var t=this;return new Promise((function(n,r){p.default.estimatedDocumentCount(e,(function(e,o){return t.resHandler({resolve:n,reject:r},{err:e,res:o})}))}))},e.prototype.userLockHandler=function(e){var t={succeeded:!0,status:200,message:""};return(e.isLocked||e.isResetPasswordLocked||e.isAccessFailedLocked)&&(t.succeeded=!1,t.status=423,e.isLocked?t.message="Account is loced, please contact admin to unlock the account.":e.isResetPasswordLocked?t.message="Your account is locked by reset password, please check your mailbox to reset your password.":e.isAccessFailedLocked&&(t.message="Your account access failed 3 times, please contact admin to unlock the account.")),t},e.prototype._getUpdateConditions=function(e,t){var n={$set:e};return e.hasOwnProperty("audit")&&(t.isAuth&&(e.audit.updatedBy=t.user._id),Object.keys(e.audit).forEach((function(t){return n.$set["audit."+t]=e.audit[t]})),delete n.$set.audit,delete n.$set["audit.updatedDate"],n.$currentDate={"audit.updatedDate":{$type:"date"}}),n},e.prototype.resHandler=function(e,t,n){var r=e.resolve,o=e.reject,a=t.err,s=t.res;return a?o(a):r(n||s)},e}());t.UserController=m},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("uuid")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this._id=e._id,this.username=e.username,this.displayName=e.displayName,this.email=e.email,this.phoneNumber=e.phoneNumber,this.avatarImageUrl=e.avatarImageUrl,this.signatureImageUrl=e.signatureImageUrl,this.isLocked=e.isLocked,this.isResetPasswordLocked=e.isResetPasswordLocked,this.isAccessFailedLocked=e.isAccessFailedLocked,this.lastLoggedIn=e.lastLoggedIn,this.audit=e.audit};t.UserDTO=r,t.mapColletionToUserDTO=function(e){var t=[];for(var n in e)t.push(new r(e[n]));return t},t.mapDocToUserDTO=function(e){return new r(e)}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),s=r(n(4)),u=n(5),i=r(n(25)),l=new s.default("quotation",new a.default("quotation")).router(o.default.Router());l.get("/quotation/getByEventPlanId/:id",u.checkAuth,(function(e,t,n){e.params.id&&i.default.findOne({eventPlan:e.params.id}).populate("customer").then((function(e){t.status(200).json({data:e})}))})),t.default=l},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(84),a=r(n(14)),s=r(n(16)),u=r(n(7)),i=n(10),l=n(11),d=r(n(12)),c=r(n(8));t.emailQueueCheckJob=o.scheduleJob("*/5 * * * *",(function(){d.default.createWriteStream(c.default.join(__dirname,"../assets/email.log"),{flags:"a"}).write("\r\ntest",(function(e){console.log(e)})),console.log("Email Queue Check is runnning in every 5 minutes"),a.default.find({isSent:!1}).then((function(e){if(e&&e.length>0){var t=e.map((function(e){return i.of(e).pipe(l.tap((function(e){return function(e){console.log("sending email...");var t=s.default.createTransport(u.default.mail),n={from:e.from,to:e.to,subject:e.subject,html:e.message};t.sendMail(n,(function(t,n){return t?(e.errorMessage=JSON.stringify(t),e.lastSendDate=new Date,e.save(),{succeeded:!1,message:t}):(e.isSent=!0,e.sentDate=new Date,e.lastSendDate=new Date,e.save(),{succeeded:!0,message:"Sent Email Successfully"})}))}(e)})))}));i.from(t).pipe(l.concatMap((function(e){return e}))).subscribe({complete:function(){console.log(new Date,"All emails are sent")}})}else console.log(new Date,"No email queue is pending")}))}))},function(e,t){e.exports=require("node-schedule")}]);
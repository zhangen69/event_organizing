<span class="mat-display-1">View Event Plan ({{ eventPlan.code }})</span>

<mat-tab-group>
  <!-- Tab1: Basis Info -->
  <mat-tab label="Basis Info">
    <div class="tab-body">
      <div class="view-field">
        <label class="mat-body-strong">Name</label>
        <div class="mat-body">{{ eventPlan.name }}</div>
      </div>
      <div class="view-field">
        <label class="mat-body-strong">Customer</label>
        <div class="mat-body">{{ eventPlan.customer?.name }}</div>
      </div>
      <div class="view-field">
        <label class="mat-body-strong">Date/Time</label>
        <div class="mat-body">{{ eventPlan.dateFrom | date: 'dd-MM-yyyy' }} -
          {{ eventPlan.dateTo | date: 'dd-MM-yyyy' }}</div>
        <div class="mat-body">{{ eventPlan.timeFrom | date: 'HH:mm a' }} - {{ eventPlan.timeTo | date: 'HH:mm a' }}
        </div>
      </div>
      <div class="view-field">
        <label class="mat-body-strong">Venue</label>
        <div class="mat-body">{{ eventPlan.venue }}</div>
      </div>
      <div class="view-field">
        <label class="mat-body-strong">Status</label>
        <div class="mat-body">{{ eventPlan.status }}</div>
      </div>
      <div class="view-field">
        <label class="mat-body-strong">Markup Rate (%)</label>
        <div class="mat-body">{{ (eventPlan.markupRate || 0) | number: '1.0-2' }}%</div>
      </div>
      <div class="view-field">
        <label class="mat-body-strong">Remarks</label>
        <div class="mat-body">{{ eventPlan.remarks }}</div>
      </div>
      <div class="action-group">
        <button class="btn-sm" routerLink="/event-plan/edit/{{eventPlan._id}}" mat-raised-button
          color="primary">Edit</button>
      </div>
    </div>
  </mat-tab>
  <!-- Tab2: Resources -->
  <mat-tab label="Resources">
    <div class="tab-body">
      <div class="mat-subheading-1">Services
        <button mat-icon-button color="primary" (click)="addItemToEvent('providerService', 'services')">
          <mat-icon>edit</mat-icon>
        </button>
        <div class="mat-body" *ngIf="eventPlan.services && eventPlan.services.length === 0">
          No service yet.
        </div>
        <ng-container *ngIf="eventPlan.services && eventPlan.services.length > 0">
          <div class="mat-body" *ngFor="let service of eventPlan.services">
            {{ service?.name }} x {{ service?.quantity }}
            {{ service?.unit }}
            ({{ service?.unitPrice * service?.quantity | currency: 'RM' }})
          </div>
        </ng-container>
      </div>
      <div class="mat-subheading-1">Facilities
        <button mat-icon-button color="primary" (click)="addItemToEvent('providerFacility', 'facilities')">
          <mat-icon>edit</mat-icon>
        </button>
        <div class="mat-body" *ngIf="eventPlan.facilities && eventPlan.facilities.length === 0">
          No facility yet.
        </div>
        <ng-container *ngIf="eventPlan.facilities && eventPlan.facilities.length > 0">
          <div class="mat-body" *ngFor="let facility of eventPlan.facilities">
            {{ facility?.name }} x {{ facility?.quantity }}
            {{ facility?.unit }}
            ({{ facility?.unitPrice * facility?.quantity | currency: 'RM' }})
          </div>
        </ng-container>
      </div>
      <div class="mat-subheading-1">Stock Items
        <button mat-icon-button color="primary" (click)="addItemToEvent('stockItem', 'stockItems')">
          <mat-icon>edit</mat-icon>
        </button>
        <div class="mat-body" *ngIf="eventPlan.stockItems && eventPlan.stockItems.length === 0">
          No stock item yet.
        </div>
        <ng-container *ngIf="eventPlan.stockItems && eventPlan.stockItems.length > 0">
          <div class="mat-body" *ngFor="let stockItem of eventPlan.stockItems">
            {{ stockItem?.name }} x {{ stockItem?.quantity }}
            {{ stockItem?.unit }}
            ({{ stockItem?.unitPrice * stockItem?.quantity | currency: 'RM' }})
          </div>
        </ng-container>
      </div>
    </div>
  </mat-tab>
  <!-- Tab3: Processes -->
  <mat-tab label="Processes">
    <div class="tab-body">
      <div class="mat-subheading-1">Processes
        <button mat-icon-button color="primary" (click)="addEventProcessToEvent()">
          <mat-icon>edit</mat-icon>
        </button>
        <mat-tab-group>
          <mat-tab *ngFor="let status of eventPlanStatus" [label]="status">
            <div class="mat-body" *ngIf="eventPlan.processes && eventPlan.processes.length === 0; else eventProcesses">
              No process yet.
            </div>
          </mat-tab>
        </mat-tab-group>
        <ng-template #eventProcesses>
          <div class="btn-group" fxLayout="row">
            <button mat-stroked-button class="btn-sm" type="button" [ngClass]="{'active': !selectProcessStatus}"
              (click)="filterProcesses()">All</button>
            <button mat-stroked-button class="btn-sm" type="button"
              [ngClass]="{'active': selectProcessStatus === 'Open'}" (click)="filterProcesses('Open')">Open</button>
            <button mat-stroked-button class="btn-sm" type="button"
              [ngClass]="{'active': selectProcessStatus === 'Progress'}"
              (click)="filterProcesses('Progress')">Progress</button>
            <button mat-stroked-button class="btn-sm" type="button"
              [ngClass]="{'active': selectProcessStatus === 'Done'}" (click)="filterProcesses('Done')">Done</button>
            <button mat-stroked-button class="btn-sm" type="button"
              [ngClass]="{'active': selectProcessStatus === 'Cancelled'}"
              (click)="filterProcesses('Cancelled')">Cancel</button>
            <button mat-stroked-button class="btn-sm" type="button"
              [ngClass]="{'active': selectProcessStatus === 'Paid'}" (click)="filterProcesses('Paid')">Pay</button>
            <button mat-stroked-button class="btn-sm" type="button"
              [ngClass]="{'active': selectProcessStatus === 'Closed'}"
              (click)="filterProcesses('Closed')">Close</button>
          </div>
          <!-- <pre>{{ filteredEventProcesses | json }}</pre> -->
          <div class="process-items" *ngFor="let process of filteredEventProcesses; let i = index; let l = count">
            <div *ngIf="!selectProcessStatus">
              <button mat-button (click)="onMoveDownPosition(process, i)" *ngIf="i !== l-1">
                <mat-icon>keyboard_arrow_down</mat-icon>
              </button>
              <button mat-button (click)="onMoveUpPosition(process, i)" *ngIf="i !== 0">
                <mat-icon>keyboard_arrow_up</mat-icon>
              </button>
            </div>
            <div class="mat-body-strong">
              {{ getDuration(process) }} <i>{{ process.type }}</i>
            </div>
            <pre fxLayout="column">
                      <span>Status: {{ process.status }}</span>
                      <div class="btn-group" fxLayout="row">
                          <button mat-stroked-button class="btn-sm" type="button" (click)="changeStatus(process, 'Open')" *ngIf="process.status !== 'Open'">Open</button>
                          <button mat-stroked-button class="btn-sm" type="button" (click)="changeStatus(process, 'Progress')" *ngIf="process.status !== 'Progress'">Progress</button>
                          <button mat-stroked-button class="btn-sm" type="button" (click)="changeStatus(process, 'Done')" *ngIf="process.status !== 'Done'">Done</button>
                          <button mat-stroked-button class="btn-sm" type="button" (click)="changeStatus(process, 'Cancelled')" *ngIf="process.status !== 'Cancelled'">Cancel</button>
                          <button mat-stroked-button class="btn-sm" type="button" (click)="changeStatus(process, 'Paid')" *ngIf="process.status !== 'Paid'">Pay</button>
                          <button mat-stroked-button class="btn-sm" type="button" (click)="changeStatus(process, 'Closed')" *ngIf="process.status !== 'Closed'">Close</button>
                      </div>
                  </pre>
            <div class="mat-body-strong">{{ process.type }}:{{ process.name }}</div>
            <div class="mat-small">{{ process?.provider?.name }}</div>
            <div class="mat-body">{{ process.remarks }}</div>
          </div>
        </ng-template>
      </div>
    </div>
  </mat-tab>
  <!-- Tab4: Form -->
  <mat-tab label="Form">
    <div class="tab-body">
      <p>Event Form Info</p>
    </div>
  </mat-tab>
  <!-- Tab5: Cost & Profit -->
  <mat-tab label="Cost & Profit">
    <div class="tab-body">
      <p>Event Cost & Profit Info</p>
      <div class="mat-subheading-1 info-group">Costs Summary
        <mat-divider></mat-divider>
        <div class="info-item">
          <div class="mat-body">Services:</div>
          <div class="mat-body">{{ eventPlan.services | getTotal: 'unitPrice': 'quantity' | currency: 'RM ' }}</div>
        </div>
        <div class="info-item">
          <div class="mat-body">Facilities:</div>
          <div class="mat-body">{{ eventPlan.facilities | getTotal: 'unitPrice': 'quantity' | currency: 'RM ' }}</div>
        </div>
        <div class="info-item">
          <div class="mat-body">Stock Items:</div>
          <div class="mat-body">{{ eventPlan.stockItems | getTotal: 'unitPrice': 'quantity' | currency: 'RM ' }}</div>
        </div>
        <mat-divider></mat-divider>
        <div class="info-item">
          <div class="mat-body-strong">Total Costs:</div>
          <div class="mat-body-strong">
            {{ ((eventPlan.services | getTotal: 'unitPrice': 'quantity') + (eventPlan.facilities | getTotal: 'unitPrice': 'quantity') + (eventPlan.stockItems | getTotal: 'unitPrice': 'quantity')) | currency: 'RM ' }}
          </div>
        </div>
        <div class="info-item">
          <div class="mat-body-strong">Total Profit ({{ eventPlan.markupRate | number: '1.0-2' }}%):</div>
          <div class="mat-body-strong">
            {{ ((eventPlan.services | getTotal: 'unitPrice': 'quantity') + (eventPlan.facilities | getTotal: 'unitPrice': 'quantity') + (eventPlan.stockItems | getTotal: 'unitPrice': 'quantity')) * eventPlan.markupRate / 100 | currency: 'RM ' }}
          </div>
        </div>
        <mat-divider></mat-divider>
        <div class="info-item">
          <div class="mat-body-strong">Total Price:</div>
          <div class="mat-body-strong">
            {{ ((eventPlan.services | getTotal: 'unitPrice': 'quantity') + (eventPlan.facilities | getTotal: 'unitPrice': 'quantity') + (eventPlan.stockItems | getTotal: 'unitPrice': 'quantity')) * ((eventPlan.markupRate / 100) + 1) | currency: 'RM ' }}
          </div>
        </div>
      </div>
      <mat-divider></mat-divider>
    </div>
  </mat-tab>
</mat-tab-group>

<pre>{{ eventPlan | json }}</pre>